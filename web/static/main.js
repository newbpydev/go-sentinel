import{W as L}from"./websocket.js";import{s as l}from"./toast.js";const f=new L;function w(t){f.connect(t)}document.addEventListener("DOMContentLoaded",function(){K(),D();const t=window.location.protocol==="https:"?"wss://":"ws://",i=window.location.host,c=`${t}${i}/ws`;try{w(c);const s=document.querySelector(".status-indicator");s&&(f.on("open",()=>{s.className="status-indicator connected",s.textContent="Connected",l("Connected to WebSocket server","success")}),f.on("close",()=>{s.className="status-indicator disconnected",s.textContent="Disconnected"}),f.on("error",r=>{console.error("WebSocket error:",r),l("WebSocket connection error","error")}))}catch(s){console.error("Failed to initialize WebSocket:",s),l("Failed to connect to WebSocket server","error")}});function K(){const t=document.getElementById("mobile-menu-toggle"),i=document.getElementById("main-menu");!t||!i||(t.addEventListener("click",function(){const c=t.getAttribute("aria-expanded")==="true";t.setAttribute("aria-expanded",(!c).toString()),i.classList.toggle("show");const s=t.querySelector("i");s&&(c?(s.className="icon-menu",s.setAttribute("aria-label","Open menu")):(s.className="icon-x",s.setAttribute("aria-label","Close menu")))}),document.addEventListener("click",function(c){const s=c.target;if(i.classList.contains("show")&&!i.contains(s)&&!t.contains(s)){i.classList.remove("show"),t.setAttribute("aria-expanded","false");const r=t.querySelector("i");r&&(r.className="icon-menu",r.setAttribute("aria-label","Open menu"))}}))}function D(){const t={active:!1,selected:new Set,lastIndex:null},i=document.getElementById("test-list"),c=document.getElementById("selection-mode-indicator"),s=document.getElementById("selection-count");if(!i)return;function r(){return i?Array.from(i.querySelectorAll(".test-item[data-id]")):[]}function u(){return r().filter(e=>e.style.display!=="none"&&getComputedStyle(e).display!=="none")}function S(e){return i?i.querySelector(`.test-item[data-id="${e}"]`):null}function A(e){const n=S(e);return n?u().findIndex(a=>a===n):-1}function m(){const e=r(),n=t.selected.size;e.forEach(o=>{const a=o.getAttribute("data-id")||"";t.selected.has(a)?(o.classList.add("selected"),o.setAttribute("aria-selected","true")):(o.classList.remove("selected"),o.setAttribute("aria-selected","false"))}),s&&(s.textContent=n.toString(),n>0?s.classList.add("has-selected"):s.classList.remove("has-selected"))}function d(e){t.active=e!==void 0?e:!t.active,t.active?(document.body.classList.add("selection-mode"),c&&(c.textContent="Selection mode active",c.style.display="block")):(document.body.classList.remove("selection-mode"),c&&(c.textContent="",c.style.display="none"),t.selected.clear()),m()}function g(e,n=!1,o=!1){t.active||d(!0);const a=A(e);if(o&&t.lastIndex!==null){const p=u(),C=Math.min(a,t.lastIndex),x=Math.max(a,t.lastIndex);for(let b=C;b<=x;b++){const I=p[b];if(I){const T=I.getAttribute("data-id")||"";t.selected.add(T)}}}else n?t.selected.has(e)?t.selected.delete(e):t.selected.add(e):(t.selected.clear(),t.selected.add(e));t.lastIndex=a,m()}function E(){const e=u();t.selected.size===e.length?t.selected.clear():e.forEach(n=>{const o=n.getAttribute("data-id")||"";t.selected.add(o)}),m()}function k(){if(t.selected.size===0)return;const e=Array.from(t.selected).join(`
`);navigator.clipboard.writeText(e).then(()=>{l(`Copied ${t.selected.size} test IDs to clipboard`,"success"),d(!1)}).catch(n=>{console.error("Failed to copy to clipboard:",n),l("Failed to copy to clipboard","error")})}function h(){if(!i){l("Test list not found","error");return}const e=Array.from(i.querySelectorAll(".test-item.fail[data-id]"));if(e.length===0){l("No failing tests to copy","info");return}const n=e.map(o=>o.getAttribute("data-id")).filter(Boolean).join(`
`);navigator.clipboard.writeText(n).then(()=>{l(`Copied ${e.length} failing test IDs to clipboard`,"success")}).catch(o=>{console.error("Failed to copy to clipboard:",o),l("Failed to copy to clipboard","error")})}i==null||i.addEventListener("click",function(e){const o=e.target.closest(".test-item[data-id]");if(!o)return;const a=o.getAttribute("data-id")||"";(t.active||e.ctrlKey||e.metaKey||e.shiftKey)&&(g(a,e.ctrlKey||e.metaKey,e.shiftKey),e.preventDefault())}),document.addEventListener("keydown",function(e){if(!["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)&&(e.key==="c"&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&(d(),e.preventDefault()),e.key==="C"&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&(h(),e.preventDefault()),!!t.active&&(e.key==="a"&&!e.ctrlKey&&!e.metaKey&&(E(),e.preventDefault()),e.key==="Enter"&&(k(),e.preventDefault()),e.key==="Escape"&&(d(!1),e.preventDefault()),e.key>="1"&&e.key<="9"))){const n=parseInt(e.key)-1,o=u();if(n<o.length){const a=o[n];if(a){const p=a.getAttribute("data-id")||"";g(p,e.ctrlKey||e.metaKey),e.preventDefault()}}}});const y=document.querySelector(".test-actions");if(y){const e=document.createElement("button");e.className="btn btn-sm btn-outline",e.innerHTML='<i class="icon-check-square"></i> Select',e.setAttribute("title","Enter selection mode (c)"),e.addEventListener("click",()=>d(!0));const n=document.createElement("button");n.className="btn btn-sm btn-outline",n.innerHTML='<i class="icon-clipboard"></i> Copy Failing',n.setAttribute("title","Copy all failing tests (C)"),n.addEventListener("click",h),y.appendChild(e),y.appendChild(n)}}
//# sourceMappingURL=main.js.map
